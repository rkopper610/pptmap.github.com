---
title: "Survey variables analysis to produce Sanky Diagram"
author: "Ryan Kopper"
date: "5/22/2020"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r}
## load libraries
library(dplyr)
#info sheet https://github.com/rstudio/cheatsheets/blob/master/data-transformation.pdf
library(networkD3)
library(tidyverse)
library(readxl)
library(readr)

#Read in each sheet individually which creates a Tibble for each.

Relationships <- read_excel("/Users/ryankopper/Clark University/Morgan Ruelle - Ryan Kopper Research/Push Pull Systematic Review/Survey relationships 2020_05_19.xlsx", sheet = "Relationships")

Recode_tables <- read_excel("/Users/ryankopper/Clark University/Morgan Ruelle - Ryan Kopper Research/Push Pull Systematic Review/Survey relationships 2020_05_19.xlsx", sheet = "Recoding Tables")

Count_of_recodes <- read_excel("/Users/ryankopper/Clark University/Morgan Ruelle - Ryan Kopper Research/Push Pull Systematic Review/Survey relationships 2020_05_19.xlsx", sheet = "Count of recodes")

```
Use DPLYR to bring together the "relationships" and "recording" sheets
 
```{r}
#Creates value for  each sheet
sheets <- excel_sheets("/Users/ryankopper/Clark University/Morgan Ruelle - Ryan Kopper Research/Push Pull Systematic Review/Survey relationships 2020_05_19.xlsx")

#Maps sheets to the data
#map_df() returns a data frame.
f <- map_df(sheets, ~ read_excel("/Users/ryankopper/Clark University/Morgan Ruelle - Ryan Kopper Research/Push Pull Systematic Review/Survey relationships 2020_05_19.xlsx", sheet = .x))

#f = all the sheets combined.
```
Join independent/dependent variable of recode table to original,

https://www.infoworld.com/article/3454356/how-to-merge-data-in-r-using-r-merge-dplyr-or-datatable.html

The first step is some kind of join command 

the second one is using the joined columns to create a new matrix with counts.
```{r}

joined_tibble <- left_join(Recode_tables, Relationships, by = c("Independent variable" = "Dependent variable")) 


glimpse(joined_tibble)
str(joined_tibble)

```
alter long data to wide data with value as counts.




SANKEY DIAGRAMS

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#SANKEY diagrams consist of three sets of elements: the nodes, the links, and the instructions which determine their positions

#trying the following pckages
library(plotly)
#or
library(networkD3)

data <- read.csv(file = "/Users/ryankopper/Clark University/Morgan Ruelle - Ryan Kopper Research/Push Pull Systematic Review/4Sanky.csv")

```
https://www.youtube.com/watch?v=S6me1r6RI4I

Nodes
"networkD3" Package

https://towardsdatascience.com/using-networkd3-in-r-to-create-simple-and-clear-sankey-diagrams-48f8ba8a4ace

```{r}


```