---
title: "Survey variables analysis to produce Sanky Diagram"
author: "Ryan Kopper"
date: "5/22/2020"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r}
## load libraries
library(dplyr)
#info sheet https://github.com/rstudio/cheatsheets/blob/master/data-transformation.pdf
library(networkD3)
library(tidyverse)
library(readxl)
library(readr)

#Read in each sheet individually which creates a Tibble for each.

Relationships <- read_excel("/Users/ryankopper/Clark University/Morgan Ruelle - Ryan Kopper Research/Push Pull Systematic Review/Survey relationships 2020_05_19.xlsx", sheet = "Relationships")

Independent_recode <- read_excel("/Users/ryankopper/Clark University/Morgan Ruelle - Ryan Kopper Research/Push Pull Systematic Review/Survey relationships 2020_05_19.xlsx", sheet = "Independent recode")

Dependent_recode <- read_excel("/Users/ryankopper/Clark University/Morgan Ruelle - Ryan Kopper Research/Push Pull Systematic Review/Survey relationships 2020_05_19.xlsx", sheet = "Dependent recode")

```
Use DPLYR to bring together the "relationships" and "recording" sheets
 
```{r}
#Creates value for  each sheet
sheets <- excel_sheets("/Users/ryankopper/Clark University/Morgan Ruelle - Ryan Kopper Research/Push Pull Systematic Review/Survey relationships 2020_05_19.xlsx")

#Maps sheets to the data
#map_df() returns a data frame.
f <- map_df(sheets, ~ read_excel("/Users/ryankopper/Clark University/Morgan Ruelle - Ryan Kopper Research/Push Pull Systematic Review/Survey relationships 2020_05_19.xlsx", sheet = .x))

#f = all the sheets combined.
```
Join independent/dependent variable of recode table to original,

https://www.infoworld.com/article/3454356/how-to-merge-data-in-r-using-r-merge-dplyr-or-datatable.html

The first step is some kind of join command 

the second one is using the joined columns to create a new matrix with counts.
```{r}

joined_tibble_check <- left_join( Relationships, Independent_recode, by = "Independent_variable") %>% left_join(Dependent_recode, by = "Dependent_variable")


joined_tibble <- left_join( Relationships, Independent_recode, by = "Independent_variable") %>% left_join(Dependent_recode, by = "Dependent_variable") %>%  select(Independent_variable_recode, Dependent_variable_recode) %>% group_by(Independent_variable_recode, Dependent_variable_recode) %>% summarise(count = n()) %>% spread(key = Dependent_variable_recode, value = count)

# glimpse(joined_tibble)
# str(joined_tibble)

```
alter long data to wide data with value as counts.

https://datacarpentry.org/R-ecology-lesson/03-dplyr.html

```{r}
restruc <- joined_tibble %>%
  group_by(Independent_variable, Dependent_variable) %>%
  summarize(joined_tibble = mean(Count...3, Count...7))

str(restruc)


restruc_spread <- restruc %>%
  spread(key = Dependent_variable, value = joined_tibble)

str(restruc_spread)



```

###
Original version made
```{r}
restruc <- joined_tibble %>%
  filter(!is.na(Count...3)) %>%
  group_by(Independent_variable, Dependent_variable) %>%
  summarize(joined_tibble = mean(Count...3))

str(restruc)


restruc_spread <- restruc %>%
  spread(key = Dependent_variable, value = joined_tibble)

str(restruc_spread)

```




SANKEY DIAGRAMS

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#SANKEY diagrams consist of three sets of elements: the nodes, the links, and the instructions which determine their positions

#trying the following pckages
library(plotly)
#or
library(networkD3)

data <- read.csv(file = "/Users/ryankopper/Clark University/Morgan Ruelle - Ryan Kopper Research/Push Pull Systematic Review/4Sanky.csv")

```
https://www.youtube.com/watch?v=S6me1r6RI4I

Nodes
"networkD3" Package

https://towardsdatascience.com/using-networkd3-in-r-to-create-simple-and-clear-sankey-diagrams-48f8ba8a4ace

```{r}


```